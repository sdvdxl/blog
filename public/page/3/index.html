<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 3 页 | 杜龙少的博客</title>
  <meta name="author" content="杜龙少">
  
  <meta name="description" content="杜龙少的博客">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="杜龙少的博客"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="杜龙少的博客" type="application/atom+xml">
  
  
    <link href="/favorite.ico" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">杜龙少的博客</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header page-header-inverse ">
  <h1 class="title title-inverse ">杜龙少的博客</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      杜龙少的博客
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/Spring-XD简介/" >Spring-XD简介</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Spring XD is a unified, distributed, and extensible service for data ingestion, real time analytics, batch processing, and data export.<br><img src="/images/xd/xd-overview.png" alt="distributed-overview."></p>
<h1 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h1><p>翻译过来就是流，通过定义stream可以控制数据的流向，比如从MongoDB读取数据然后存储到HDFS中。<br><img src="/images/xd/stream.png" alt="stream"></p>
<h2 id="创建方式"><a href="#创建方式" class="headerlink" title="创建方式"></a>创建方式</h2><p>一个简单的示例：该示例创建一个名字叫<code>ticktock</code>的stream，每秒钟产生一条时间信息然后通过管道传送到log中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xd:&gt; stream create --definition &quot;time | log&quot; --name ticktock</span><br></pre></td></tr></table></figure></p>
<h2 id="销毁Stream"><a href="#销毁Stream" class="headerlink" title="销毁Stream"></a>销毁Stream</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xd:&gt; stream destroy --name stream-name</span><br></pre></td></tr></table></figure>
<h1 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h1><p>模块，当前包含<code>source</code>, <code>sink</code>,<code>processor</code>, 和<code>job</code>。</p>
<h1 id="Souces"><a href="#Souces" class="headerlink" title="Souces"></a>Souces</h1><p>数据源，Stream的来源，有以下几种方式：</p>
<table>
<thead>
<tr>
<th>方式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>File</td>
<td>文件方式</td>
</tr>
<tr>
<td>FTP</td>
<td>FTP方式</td>
</tr>
<tr>
<td>GemFire Continuous Query(gemfire-cq)</td>
<td>GemFire查询</td>
</tr>
<tr>
<td>GemFire source(gemfire)</td>
<td>GemFire文件</td>
</tr>
<tr>
<td>HTTP</td>
<td>http方式</td>
</tr>
<tr>
<td>JDBC Source(jdbc)</td>
<td>关系型数据库jdbc</td>
</tr>
<tr>
<td>JMS</td>
<td>JMS</td>
</tr>
<tr>
<td>Kafka</td>
<td>Kafka消息队列</td>
</tr>
<tr>
<td>Mail</td>
<td>通过接收电子邮件</td>
</tr>
<tr>
<td>MongoDB Source(mongodb)</td>
<td>MongoDB数据库</td>
</tr>
<tr>
<td>MQTT</td>
<td>MQTT</td>
</tr>
<tr>
<td>RabbitMQ</td>
<td>RabbitMQ消息队列</td>
</tr>
<tr>
<td>Reactor IP(reactor-ip)</td>
<td>Reactor IP(reactor-ip)</td>
</tr>
<tr>
<td>SFTP</td>
<td>SFTP</td>
</tr>
<tr>
<td>Stdout Capture</td>
<td>标准输入</td>
</tr>
<tr>
<td>Syslog</td>
<td>系统日志</td>
</tr>
<tr>
<td>Tail</td>
<td>Tail程序</td>
</tr>
<tr>
<td>TCP</td>
<td>TCP</td>
</tr>
<tr>
<td>TCP Client(tcp-client)</td>
<td>TCP 客户端</td>
</tr>
<tr>
<td>Time</td>
<td>时间</td>
</tr>
<tr>
<td>Trigger Source(trigger)</td>
<td>触发器</td>
</tr>
<tr>
<td>Twitter Search(twittersearch)</td>
<td>Twitter搜索</td>
</tr>
<tr>
<td>Twitter Stream(twitterstream)</td>
<td>Twitter Stream流</td>
</tr>
</tbody>
</table>
<h1 id="Sinks"><a href="#Sinks" class="headerlink" title="Sinks"></a>Sinks</h1><p>数据源，Stream的输出，有以下几种方式：</p>
<table>
<thead>
<tr>
<th>方式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dynamic Router(router)</td>
<td>动态路由</td>
</tr>
<tr>
<td>File Sink(file)</td>
<td>文件方式</td>
</tr>
<tr>
<td>FTP Sink(ftp)</td>
<td>FTP方式</td>
</tr>
<tr>
<td>GemFire Server</td>
<td>GemFire服务器</td>
</tr>
<tr>
<td>GPFDIST</td>
<td>GPFDIST</td>
</tr>
<tr>
<td>Cassandra</td>
<td>Cassandra 数据库</td>
</tr>
<tr>
<td>Hadoop(HDFS) (hdfs)</td>
<td>hdfs文件系统</td>
</tr>
<tr>
<td>HDFS Dataset(Avro/Parquet) (hdfs-dataset)</td>
<td>hdfs文件系统中的avro或者parquet类型文件</td>
</tr>
<tr>
<td>JDBC Source(jdbc)</td>
<td>关系型数据库jdbc</td>
</tr>
<tr>
<td>Kafka Sink (kafka)</td>
<td>Kafka消息队列</td>
</tr>
<tr>
<td>Log</td>
<td>log 文件</td>
</tr>
<tr>
<td>Mail</td>
<td>Mail 发送</td>
</tr>
<tr>
<td>Mongo</td>
<td>Mongo数据库</td>
</tr>
<tr>
<td>MQTT Sink (mqtt)</td>
<td>MQTT</td>
</tr>
<tr>
<td>Null Sink(null)</td>
<td>null</td>
</tr>
<tr>
<td>RabbitMQ</td>
<td>RabbitMQ 消息队列</td>
</tr>
<tr>
<td>Redis</td>
<td>Redis</td>
</tr>
<tr>
<td>Shell Sink (shell)</td>
<td>shell</td>
</tr>
<tr>
<td>Splunk Server (splunk)</td>
<td>splunk</td>
</tr>
<tr>
<td>TCP Sink (tcp)</td>
<td>TCP</td>
</tr>
</tbody>
</table>
<h1 id="Processors"><a href="#Processors" class="headerlink" title="Processors"></a>Processors</h1><p>可用的处理器包括<code>Aggregator</code> <code>Filter</code> <code>Header Enricher</code> <code>HTTP Client</code> <code>JSON to Tuple</code> <code>Object to JSON</code> <code>Script</code> <code>Shell Command</code> <code>Splitter</code> <code>Transform</code></p>
<ul>
<li>Aggregator – 作用和 splitter相反，用于聚合，</li>
<li>Splitter – 用于拆解</li>
<li>Filter – 过滤器，用于中间处理数据</li>
<li>Header Enricher (header-enricher) – 用于添加头部信息</li>
<li>HTTP Client – 通过httpClient方式发送URL请求</li>
<li>JSON to Tuple (json-to-tuple) – 转换json数据到Tuple类型</li>
<li>Object to JSON (object-to-json) – 将对象转换为json格式</li>
<li>Script 用于加载Groovy脚本</li>
<li>Shell – 用于加载Shell脚本</li>
<li>Transform – 用于负载类型转换</li>
</ul>
<h1 id="Taps"><a href="#Taps" class="headerlink" title="Taps"></a>Taps</h1><p>监听器，窃听器。<br>不用重复定义相同的stream，然后监听此stream就可以做其他操作。并且可以用Label来分别对每个部分内容做个别名，定义Tab时候可以使用别名。如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stream create foo --definition &quot;httpLabel: http | fLabel: filter --expression=payload.startsWith(&apos;A&apos;) | flibble: transform --expression=payload.toLowerCase() | log&quot; --deploy</span><br><span class="line">stream create fooTap --definition &quot;tap:stream:foo.flibble &gt; log&quot; --deploy</span><br></pre></td></tr></table></figure></p>
<p>上面对trasfrom部分做了一个别名，叫做<code>flibble</code>，然后下面定义一个Tap，并且最后指定是flibble这个标签，那么就是对<code>foo</code>这个stream的<code>flibble</code>做监听。</p>
<h1 id="Jobs"><a href="#Jobs" class="headerlink" title="Jobs"></a>Jobs</h1><p>Job相比Stream不同点在于，Job算是静态的，Stream是动态的。Stream会持续接收数据，处理数据；Job是一次性接收数据，处理数据，如果数据改变，那么是不会进行处理的，除非有定时任务。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">job create --name jobtest --definition &apos;timestampfile --directory=D:/jobs&apos; --deploy</span><br><span class="line">stream create --name time-cron --definition &quot;trigger --cron=&apos;* * * * * *&apos; &gt; queue:job:jobtest&quot; --deploy</span><br></pre></td></tr></table></figure></p>
<h1 id="使用counter"><a href="#使用counter" class="headerlink" title="使用counter"></a>使用counter</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">stream create foo --definition &apos;http --outputType=application/json | log&apos;</span><br><span class="line">stream create countName --definition &apos;tap:stream:foo &gt; field-value-counter --fieldName=name&apos; --deploy</span><br><span class="line">stream deploy --name foo</span><br><span class="line">http post --data &#123;&quot;name&quot;:&quot;a&quot;&#125;</span><br><span class="line">http post --data &#123;&quot;name&quot;:&quot;a&quot;&#125;</span><br><span class="line">http post --data &#123;&quot;name&quot;:&quot;b&quot;&#125;</span><br></pre></td></tr></table></figure>
<p><code>field-value-counter list</code> 列出field-value-counter的名字<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FieldValueCounter name</span><br><span class="line">----------------------</span><br><span class="line">countName</span><br></pre></td></tr></table></figure></p>
<p><code>field-value-counter display --name countName</code> 列出名字为<code>countName</code>的描述</p>
<pre><code>FieldValueCounter=countName
---------------------------  -  -----
VALUE                        -  COUNT
a                            |  2
b                            |  1
</code></pre>
	
	</div>
  <a type="button" href="/2016/03/09/Spring-XD简介/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/以分布式方式运行Spring-XD/" >以分布式方式运行Spring-XD</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p><em>主要以官方文档说明进行配置</em></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Spring XD分布式运行环境（DIRT）支持以分布式方式运行多个跨节点的任务。参见<a href="http://docs.spring.io/spring-xd/docs/1.3.1.RELEASE/reference/html/#getting-started" target="_blank" rel="external">Getting Started</a>获取以单个节点运行方式的信息。</p>
<p>XD的分布式运行架构主要由以下组件构成：</p>
<ul>
<li>Admin 主要用于管理Stream，Job的发布，用户操作，和提供运行时相关的状态，系统统计和分析的REST服务</li>
<li>Container 托管发布的模块（Stream处理任务）和批量任务</li>
<li>ZooKeeper 提供所有XD运行时的信息。追踪Container信息，如：modules，jobs发布情况，steam定义，发布状态等。</li>
<li>Spring Batch Job Repository Database –这个要求要配置一个关系型数据库。XD包含了HSQLDB，但是不推荐用在生产环境中。XD支持任何JDBC型数据库。</li>
<li>A Message Broker –用于数据传输。XD的数据传输模块设计成了插拔式。当前XD版本支持<code>Rabbit MQ</code>和<code>Redis</code>，这两个都支持stream和job过程产生的数据的传输，<code>Kafka</code>仅支持steam产生的数据传输。请注意：job使用Kafka作为数据传输是不稳定的。这个项目必须要配置一个作为数据传输的插件（推荐Redis）。</li>
<li>Analytics Repository – XD目前用Redis作为counters和gauges分析的存储方式。<br>XD的分布式运行环境概览如下：<br><img src="/images/xd/distributed-runtime-overview.png" alt="distributed-runtime-overview"></li>
</ul>
<h1 id="Server-Configuration"><a href="#Server-Configuration" class="headerlink" title="Server Configuration"></a>Server Configuration</h1><p>默认查找<code>$XD_HOME/config/servers.yml</code>文件，作为配置文件。<br>但是可以使用<code>XD_CONFIG_LOCATION</code>环境变量改变配置文件夹，使用<code>XD_CONFIG_NAME</code>改变配置文件位置，如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export XD_CONFIG_LOCATION=file:/xd/config/</span><br><span class="line">export XD_CONFIG_NAME=region1-servers</span><br></pre></td></tr></table></figure></p>
<ul>
<li>注意，<code>XD_CONFIG_LOCATION</code>最后的<code>/</code>是必须的。</li>
</ul>
<h1 id="Database-Configuration"><a href="#Database-Configuration" class="headerlink" title="Database Configuration"></a>Database Configuration</h1><p>MySQL，PostGresql选其中一个配置即可，当然还有Oracle也可以配置，但是在这里没有列出，可以<a href="http://docs.spring.io/spring-xd/docs/1.3.1.RELEASE/reference/html/#_database_configuration" target="_blank" rel="external">]参考官方文档</a><br><code>xd-singlenode</code>模式是使用了一个嵌入式<code>HSQLDB</code>数据库，运行分布式模式的时候，可以使用独立的<code>HSQLDB</code>，但是仅仅推荐在学习和开发的时候使用它，正式环境最好使用其他比如<code>MySQL</code>，<code>Postgres</code>等等数据库。</p>
<ul>
<li>注意：如果在stream模块中使用除了<code>Postgres</code>和<code>HSQLDB</code>数据库，那么需要把对应的驱动放到<code>$XD_HOME/lib</code>目录。<br><code>servers.yml</code>文件中已经注释了一部分jdbc配置信息，可以按需更改。</li>
</ul>
<h2 id="MySQL配置"><a href="#MySQL配置" class="headerlink" title="MySQL配置"></a><code>MySQL</code>配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">    datasource:</span><br><span class="line">    url: jdbc:mysql://yourDBhost:3306/yourDB</span><br><span class="line">    username: yourUsername</span><br><span class="line">    password: yourPassword</span><br><span class="line">    driverClassName: com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure>
<h2 id="Postgresql配置"><a href="#Postgresql配置" class="headerlink" title="Postgresql配置"></a>Postgresql配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:postgresql://yourDBhost:5432/yourDB</span><br><span class="line">    username: yourUsername</span><br><span class="line">    password: yourPassword</span><br><span class="line">    driverClassName: org.postgresql.Driver</span><br></pre></td></tr></table></figure>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>stream和job的数据传输需要用到（Rabbit MQ也可以）（当用作数据分析时候也需要），这里推荐统一使用redis作为配置，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">   port: 6379</span><br><span class="line">   host: localhost</span><br><span class="line">   pool:</span><br><span class="line">     maxIdle: 8 # max idle connections in the pool</span><br><span class="line">     minIdle: 0 # min idle connections in the pool</span><br><span class="line">     maxActive: -1 # no limit to the number of active connections</span><br><span class="line">     maxWait: 30000 # time limit to get a connection - only applies if maxActive is finite</span><br></pre></td></tr></table></figure></p>
<h3 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h3><p>从<a href="redis.io">官网</a>下载最新的redis，然后解压，进入redis根目录，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd deps</span><br><span class="line">make hiredis jemalloc linenoise lua</span><br><span class="line">cd ..</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p>
<p>注意：依赖于gcc和make（Ubuntu系列如果没有安装 apt-get install gcc make）</p>
<h1 id="开启页面登录密码保护"><a href="#开启页面登录密码保护" class="headerlink" title="开启页面登录密码保护"></a>开启页面登录密码保护</h1><p>默认ui管理界面是没有安全配置的，不需密码即可访问，为了安全起见，我们可以设置登录用户和密码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles: admin                                                     (1)</span><br><span class="line">security:</span><br><span class="line">  basic:</span><br><span class="line">    enabled: true                                                     (2)</span><br><span class="line">    realm: SpringXD                                                  </span><br><span class="line">  user:</span><br><span class="line">    name: yourAdminUsername</span><br><span class="line">    password: yourAdminPassword</span><br><span class="line">    role: ADMIN, VIEW, CREATE</span><br></pre></td></tr></table></figure></p>
<p>注意：<code>spring.batch.initializer.enabled</code>默认是true，会使Spring Bath初始化表结构。</p>
<h1 id="启动admin"><a href="#启动admin" class="headerlink" title="启动admin"></a>启动admin</h1><p>admin只会有一个，用来协调container和管理相关stream，job等。<br><code>xd/bin/xd-admin</code></p>
<h1 id="启动container"><a href="#启动container" class="headerlink" title="启动container"></a>启动container</h1><p>container可以启动多个，也就是组成多个节点，由此构成分布式运行环境。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xd/bin/xd-container</span><br></pre></td></tr></table></figure></p>
<h1 id="创建Stream"><a href="#创建Stream" class="headerlink" title="创建Stream"></a>创建Stream</h1><p>进入<code>$XD_HOME/shell/</code>,控制台输入<code>bin/xd-shell</code>，进去xd命令行交互模式，然后输入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stream create --name foo --definition &apos;time | log&apos; --deploy</span><br></pre></td></tr></table></figure></p>
<p>即可看见admin日志（控制台没关闭的话也可以看到）有时间信息输出。</p>
<p>下面这个stream是从kafka读取信息，然后传输到log里，所以需要配置kafka，请查阅kafka相关资料。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stream create --name kafkaDevice --definition &apos;kafka --outputType=text/plain --zkconnect=10.10.1.20:2181 --topic=kafka_test --offsetStorage=redis | log &apos; --deploy</span><br></pre></td></tr></table></figure>
<h1 id="末"><a href="#末" class="headerlink" title="末"></a>末</h1><p>最后贴出一份比较完整的配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">security:</span><br><span class="line">  basic:</span><br><span class="line">    enabled: true</span><br><span class="line">    realm: SpringXD</span><br><span class="line">  user:</span><br><span class="line">    name: hekr</span><br><span class="line">    password: hekr</span><br><span class="line">    # 必须配置角色才会生效</span><br><span class="line">    role: ADMIN, VIEW, CREATE</span><br><span class="line">spring:</span><br><span class="line">    redis:</span><br><span class="line">       port: 6379</span><br><span class="line">       host: 127.0.0.1</span><br><span class="line">       pool:</span><br><span class="line">          maxIdle: 8 # max idle connections in the pool</span><br><span class="line">          minIdle: 0 # min idle connections in the pool</span><br><span class="line">          maxActive: -1 # no limit to the number of active connections</span><br><span class="line">          maxWait: 30000 # time limit to get a connection - only applies if maxActive is finite</span><br><span class="line">       #sentinel:</span><br><span class="line">       #   master: mymaster</span><br><span class="line">       #   nodes: 127.0.0.1:26379,127.0.0.1:26380,127.0.0.1:26381</span><br><span class="line">    batch:</span><br><span class="line">        isolationLevel: ISOLATION_SERIALIZABLE</span><br><span class="line">        # clobType:</span><br><span class="line">        dbType: MYSQL</span><br><span class="line">        maxVarcharLength: 2500</span><br><span class="line">        tablePrefix: BATCH_</span><br><span class="line">        validateTransactionState: true</span><br><span class="line">        initializer:</span><br><span class="line">          enabled: true</span><br><span class="line">    datasource:</span><br><span class="line">        url: jdbc:mysql://localhost:3306/xd</span><br><span class="line">        username: root</span><br><span class="line">        password: hekr</span><br><span class="line">        driverClassName: com.mysql.jdbc.Driver</span><br><span class="line">        testOnBorrow: true</span><br><span class="line">        validationQuery: select 1</span><br><span class="line">zk:</span><br><span class="line">  namespace: xd</span><br><span class="line">  client:</span><br><span class="line">     connect: 10.10.1.20:2181</span><br><span class="line">     sessionTimeout: 60000</span><br><span class="line">     connectionTimeout: 30000</span><br><span class="line">     initialRetryWait: 1000</span><br><span class="line">     retryMaxAttempts: 3</span><br><span class="line">xd:</span><br><span class="line">    transport: redis</span><br></pre></td></tr></table></figure>
<p>##注意：</p>
<ol>
<li>配置权限后，进入xd-shell会显示<code>server-unknown:&gt;</code>， 需要配置一下admin server才能进入交互</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin config server --uri http://服务器地址:端口(默认9393) --username 用户名 --password 密码</span><br></pre></td></tr></table></figure>
<ol>
<li><code>testOnBorrow</code>默认是<code>true</code>，如果配置为true或者没有配置，则需要配置正确的<code>validationQuery</code>，如果配置不正确则会有类似如下异常出现<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Command failed org.springframework.xd.rest.client.impl.SpringXDException: Could not get JDBC Connection; nested exception is java.sql.SQLException: Failed to validate a newly established connection.</span><br></pre></td></tr></table></figure>
</li>
</ol>

	
	</div>
  <a type="button" href="/2016/03/09/以分布式方式运行Spring-XD/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/Jrebel插件配置参数/" >Jrebel插件配置参数</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="JVM-参数"><a href="#JVM-参数" class="headerlink" title="JVM 参数"></a>JVM 参数</h1><p><code>-javaagent:/path/jrebel.jar</code></p>
<h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="Spring-Bean-Core-MVC-Security-Webflow-WS"><a href="#Spring-Bean-Core-MVC-Security-Webflow-WS" class="headerlink" title="Spring Bean/Core/MVC/Security/Webflow/WS"></a>Spring Bean/Core/MVC/Security/Webflow/WS</h2><p><code>-Drebel.spring_plugin=true</code></p>
<h2 id="Spring-Data"><a href="#Spring-Data" class="headerlink" title="Spring Data"></a>Spring Data</h2><p><code>-Drebel.spring_data_plugin=true</code></p>
<h2 id="Struts"><a href="#Struts" class="headerlink" title="Struts"></a>Struts</h2><p><code>-Drebel.struts2_plugin=true</code></p>
<h1 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h1><p><code>-Drebel.hibernate_plugin=true</code></p>
<h1 id="Hibernate-Validator"><a href="#Hibernate-Validator" class="headerlink" title="Hibernate Validator"></a>Hibernate Validator</h1><p><code>-Drebel.hibernate_validator_plugin=true</code></p>
<h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><p><code>-Drebel.mybatis_plugin=true</code></p>
<h1 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h1><p><code>-Drebel.logback_plugin=true</code></p>
<h1 id="Log4J-2"><a href="#Log4J-2" class="headerlink" title="Log4J 2"></a>Log4J 2</h1><p><code>-Drebel.log4j2_plugin=true</code></p>
<p>#Groovy<br><code>-Drebel.groovy_plugin=true</code></p>
<h1 id="Jruby"><a href="#Jruby" class="headerlink" title="Jruby"></a>Jruby</h1><p><code>-Drebel.jruby_plugin=true</code></p>
<h1 id="GWT"><a href="#GWT" class="headerlink" title="GWT"></a>GWT</h1><p><code>-Drebel.gwt_plugin=true</code></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://manuals.zeroturnaround.com/jrebel/misc/frameworks.html" target="_blank" rel="external">plugins</a></p>

	
	</div>
  <a type="button" href="/2016/03/09/Jrebel插件配置参数/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/archlinux安装ntfs驱动/" >archlinux安装ntfs驱动</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>默认情况下，archlinux本身支持挂在ntfs文件系统，只不过是只读，不能写入。如果要支持ntfs系统文件，那么需要安装ntfs的驱动程序。<br>用命令 <code>yaourt -Ss ntfs</code> 可以查找关于ntfs的软件包<br>&gt;<br>extra/ntfs-3g 2014.2.15-1 [installed]<br>    NTFS filesystem driver and utilities<br>aur/disk-manager 1.0.1-3 (56)<br>    A tool to manage filesystems, partitions, and NTFS write mode<br>aur/fgetty 0.7-5 (14)<br>    A mingetty stripped of the printfs<br>aur/fgetty-pam 0.7-4 (4)<br>    A mingetty stripped of the printfs, patched for PAM-support.<br>aur/grub4dos 0.4.5c_20140822-1 (35)<br>    A GRUB boot loader support menu on windows(fat,ntfs)/linux(ext2,3,4)<br>aur/libntfs-wii 2013.1.13-1 (1)<br>    NTFS-3G filesystem access library (for Nintendo Gamecube/Wii homebrew<br>    development)<br>aur/ntfs-3g-ar 2014.2.15AR.3-1 (37)<br>    NTFS filesystem driver and utilities with experimental features<br>aur/ntfs-3g-fuse 2014.2.15-1 (46)<br>    Stable read and write NTFS driver and ntfsprogs. This package will allow<br>    normal users to mount NTFS Volumes.<br>aur/ntfs-3g_ntfsprogs-git 4695.db35a16-1 (7)<br>    Read and write NTFS driver and utilities - GIT version<br>aur/ntfs-config 1.0.1-13 (119)<br>    Enable/disable NTFS write support with a simple click<br>aur/ntfsfixboot 1.0-3 (18)<br>    Fix NTFS boot sector<br>aur/scrounge-ntfs 0.9-2 (28)<br>    Data recovery program for NTFS file systems<br>aur/ufsd-module 8.9.0-3 (9)<br>    Paragon NTFS &amp; HFS for Linux driver. - ACLs removed<br>aur/ufsd-module-dkms 8.9.0-3 (4)<br>    Paragon NTFS &amp; HFS for Linux driver. - ACLs removed. DKMS version<br>aur/wipefreespace 2.0-1 (3)<br>    Securely wipe the free space on an ext2/3/4,NTFS, XFS,ReiserFSv3,<br>    ReiserFSv4, FAT12/16/32,Minix,JFS and HFS+ partition or drive</p>
<p>可以看到有这么多相关软件包，其实只需要安装第一个也就是 <code>extra/ntfs-3g</code> 就可以了，输入命令 <code>yaourt -S extra/ntfs-3g</code>，安装完毕后重新插入ntfs分区U盘或者移动硬盘就可以进行写入操作了。</p>

	
	</div>
  <a type="button" href="/2016/03/09/archlinux安装ntfs驱动/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/archlinux安装/" >archlinux安装</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本人也是第一次安装archlinux，严格来说是第一次安装成功，记录一下，既为自己也为新手。此方式是非UEFI模式，并且分区表使DOS的MBR方式，GPT分区表没有测试。以后也许会在虚拟机中测试过进行补充。</p>
<h1 id="温馨提示"><a href="#温馨提示" class="headerlink" title="温馨提示"></a>温馨提示</h1><p>建议现在虚拟机中安装几次，直到安装成功，并且可以正常开机，上网，打开桌面环境，有十足把握之后再在物理机上安装，以免中间出现问题又没办法解决。并在虚拟机安装的过程中记录遇到的问题，以便日后参考。同时安装的时候记得备份重要文件，以免安装错误导致文件丢失。</p>
<h1 id="准备安装介质"><a href="#准备安装介质" class="headerlink" title="准备安装介质"></a>准备安装介质</h1><ol>
<li>首先准备archlinux镜像，如果没有可以<a href="https://www.archlinux.org/download/" target="_blank" rel="external">点击这里下载</a>，最好选择中国的镜像服务，比如<a href="http://mirrors.163.com/archlinux/iso/2015.01.01/" target="_blank" rel="external">网易的</a>。下载完成后校验一下MD5值（官方文件的MD5值在md5sums.txt 这个文件中），如果相同那么可以进行下一步了；如果不相同需要重新下载并校验，不推荐在MD5值不同的情况下继续进行，因为不知道会发生什么问题。</li>
<li>刻录至U盘。如果用的是linux系统或者Mac系统（话说这么优雅的系统为啥要换呢，也可能是双系统吧），可以使用 <code>dd</code> 命令。把U盘插入计算机， 输入命令 <code>ls -al /dev/sd*</code>, 一般sdb是你的U盘，也请先做好文件备份。 现在假定U盘是 /dev/sdb, archlinux的文件路径是 /home/user/archlinux.iso,那么输入命令(需root权限) <code>dd -if=/home/user/archlinux.iso -of=/dev/sdb</code>，然后等待命令执行完毕，如果没有任何提示，则代表成功了。</li>
</ol>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>   <strong> 再次提醒，做好文件备份 </strong></p>
<ol>
<li>如果没有分区的话，先进行分区，并进行格式化，如果已经操作过了或者想重用上次系统(Linux)的分区，可以直接进入第2步。<ul>
<li>分区进行时：<br>敲入命令 <code>fdisk /dev/sda</code> (假定操作的磁盘时sda，请自行确认好，此操作要格外小心)。输入 <code>m</code> 可以查看帮助， <code>n</code> 是新建一个分区， <code>d</code> 是删除一个已有分区。如果想新建一个DOS分区表，则输入 <code>o</code>，已经有分区表，想重新分区的话，按 <code>d</code> ，直到删除所有分区。分区方案可以按照以下来： <code>/boot</code>  大概需要  <code>200M</code>， <code>/</code> 可以分配 <code>15G</code> ～ <code>40G</code>， <code>/var</code> <code>8G</code>～ <code>20G</code> (可选)  ， <code>/tmp</code> <code>4G</code> ～ <code>8G</code> (可选)，其余分给 <code>/home</code>分区（强烈建议单独分区，以后重装系统可以不用拷贝主目录下的资料了）， <code>swap</code> <code>4G</code> ～ <code>8G</code>（可选）。新建分区输入 <code>n</code>，默认（p主分区）即可，然后默认（分区号1），接下来也是默认扇区既可以，然后选择大小，可以输入G,M,K单位的大小，我们输入 <code>+200M</code>，确定；然后创建根分区，按<code>n</code>,一路下来，大小选择输入 <code>+15G</code>,确定，根分区创建完成。如果分区少于4个，可以按照上面步骤，直到分区创建完成；但是如果分区多于4个，就要创建扩展分区，然后再创建逻辑分区了。扩展分区的创建和上面一样，只不过在选择分区格式的时候不是输入 <code>p</code> 了，而是 <code>e</code>，其余一样的。创建逻辑分区的时候输入 <code>l</code> （英文L的小写字母），剩下的步骤也是和创建主分区一样的啦。所有分区创建完成后，输入 <code>w</code> ，上面的一系列操作才会真正写入磁盘，再次之前都是在内存中，所以，在按 <code>w</code> 之前，还是有后悔药吃的，但是按下之后，那就定格了。切记！</li>
<li>格式化分区：<br>格式化分区的命令是 <code>mkfs.xxx</code>，输入 <code>mkfs.</code>，按 <code>Tab</code> 键可以看到有如下格式：  <code>mkfs.bfs</code>       <code>mkfs.ext2</code>      <code>mkfs.ext4</code>      <code>mkfs.jfs</code>       <code>mkfs.reiserfs</code> <code>mkfs.cramfs</code>    <code>mkfs.ext3</code>      <code>mkfs.ext4dev</code>  <code>mkfs.minix</code>     <code>mkfs.xfs</code>。咦，好像没有swap分区格式，swap分区格式化的命令是 <code>mkswap</code> 啦。输入命令 <code>mkfs.ext4 /dev/sda1</code> 将 <code>/boot</code> 分区格式化成ext4格式的分区，根分区和其他非swap分区用此方法依次格式化，用 <code>mkswap /dev/sdax</code> 格式化上面分的swap分区，x是分swap分区所得的号码。</li>
</ul>
</li>
</ol>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol>
<li>mount 相关分区。 <code>mkdir /mnt/home /mnt/tmp /mnt/var /mnt/boot</code>  创建home，tmp，var，boot挂载点目录，然后 <code>mount /dev/sdax /mnt/xx</code> x代表分区号，xx代表目录，把的分区挂载到相应挂载点上。</li>
<li><p>修改 <code>/etc/pacman.d/mirrorlist</code> 的镜像列表，可以删除所有的，然后输入<br>&gt;<br>Server = <a href="http://mirrors.163.com/archlinux/$repo/os/x86_64" target="_blank" rel="external">http://mirrors.163.com/archlinux/$repo/os/x86_64</a></p>
<p>   保存退出。</p>
<ol>
<li>执行 <code>pacstrap /mnt base</code> 命令进行基础安装。</li>
<li>生成fstab。 <code>genfstab -p /mnt &gt;&gt; /mnt/etc/fstab</code>, 查看一下/mnt/etc/fstab 内容格式是否正确，有无重复内容，如有请先订正。格式大体如下：<br>&gt;<br>#<br># /etc/fstab: static file system information<br>#<br># <file system="">    <dir>    <type>    <options>    <dump>    <pass><br># UUID=ee8bae58-9428-4917-b63e-0258d19a4567<br>/dev/sda5               /             ext4          rw,relatime,data=ordered0 1<br># UUID=cbac48fe-3345-4cba-96ec-acdbdc56d0ad<br>/dev/sda9               /home         ext4          rw,relatime,data=ordered0 2<br># UUID=59e210c2-fced-4cdd-b631-d9a50ba82312<br>/dev/sda7               /tmp          ext4          rw,relatime,data=ordered0 2</pass></dump></options></type></dir></file></li>
<li>切换到新系统的root目录下，命令  <code>arch-choot /mnt</code></li>
<li>设置主机名 <code>echo your_hostname &gt; /etc/hostname</code> ， your_hostname换成你想要的，最好是纯英文。</li>
<li>设置时区。 <code>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code>。</li>
<li>修改 <code>/etc/locale.gen</code> ， 添加以下内容<br>&gt;<br>en_US.UTF-8 UTF-8<br>zh_CN.UTF-8 UTF-8</li>
</ol>
<p>执行 <code>locale-gen</code>，</p>
<ol>
<li>执行 <code>echo LANG=zh_CN.UTF-8 &gt; /etc/locale.conf</code></li>
<li>设置键盘映射和字体，文件在 <code>/etc/vconsole.conf</code>，在这就保持默认配置了。</li>
<li>设置root密码 <code>passwd</code> 然后输入密码，再输入一次确认。</li>
<li>安装引导程序，这里用grub。 <code>pacman -Sy grub</code>，安装完成后，执行  <code>pacman-db-upgrade</code>， 然后再执行 <code>grub-install --target=i386-pc --recheck --debug /dev/sda</code> 安装grub引导到sda上。最后执行 <code>grub-mkconfig -o /boot/grub/grub.cfg</code> ，生成引导配置。</li>
<li>重启， 执行 <code>reboot</code>。如果成功安装的话，会出现grub引导选择系统菜单，选择默认的进入，输入root用户名，输入密码，登录成功。至此，安装已经完成，接下来是配置。</li>
</ol>
</li>
</ol>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol>
<li><p>网络配置</p>
<ul>
<li>查看网络设备名称 <code>ls /sys/class/net</code>, 记住所看到的网卡接口名称，假定叫做eth0</li>
<li>启用网络接口 ip link set eth0 up</li>
<li>检查结果状态 <code>ip link show dev eth0</code> 如果打印<br>&gt;<br>enp3s0: <broadcast,multicast,up,lower_up> mtu 1500 qdisc fq_codel state UP mode DEFAULT    group default qlen 1000<br>link/ether 00:e0:66:cb:e2:1e brd ff:ff:ff:ff:ff:ff</broadcast,multicast,up,lower_up></li>
</ul>
<p>类似内容，说明启用成功。</p>
</li>
<li>创建或编辑 <code>/etc/systemd/network/dhcp.network</code> ,添加以下内容：<br>&gt;<br>[Match]<br>Name=en*<br>[Network]<br>DHCP=v4</li>
</ol>
<ol>
<li>启用网络服务 <code>systemctl enable systemd-resolved</code></li>
<li><p>编辑 <code>/etc/resolv.conf</code> 配置dns ， 添加以下内容：<br>&gt;<br>nameserver 8.8.8.8<br>nameserver 4.4.4.4</p>
<p>如果你的IP段在192.168.xxx.yyy,则再添加 nameserver 192.168.xxx.1</p>
</li>
<li><p>执行 <code>dhcpd</code> 启用dhcp，要开机自动启动dhcp服务，则执行 <code>systemctl enable dhcpd</code><br>基本环境配置已经完成。</p>
</li>
</ol>
<h1 id="桌面环境配置"><a href="#桌面环境配置" class="headerlink" title="桌面环境配置"></a>桌面环境配置</h1><p>安装 fxce4</p>
<p>pacman -S xorg xorg-server<br>pacman -S slim #登录管理器<br>pacman -S xfce4<br>pacman -S xfce4-goodies<br>pacman -S fortune-mode<br>pacman -S gamin</p>
<ol>
<li>创建用户 <code>useradd -Um du</code></li>
<li>设置密码 <code>passwd du</code></li>
<li>切换用户  <code>su -l du</code></li>
<li>输入 <code>startxfce4</code> 可以进入xfce桌面了</li>
</ol>
<h1 id="美化显示："><a href="#美化显示：" class="headerlink" title="美化显示："></a>美化显示：</h1><ul>
<li><p>字体</p>
<ol>
<li>首先可以从windowns上或者其他地方准备字体文件，然后 <code>cp *.ttf ~/.fonts/</code></li>
<li>建立字体缓存<br><code>mkfontscale</code><br><code>mkfontdir</code><br><code>fc-cache -fv</code></li>
</ol>
</li>
<li><p>输入法 <a href="https://wiki.archlinux.org/index.php/Fcitx_%28%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87%29#.E8.BE.93.E5.85.A5.E6.B3.95.E6.A8.A1.E5.9D.97" target="_blank" rel="external">传送门</a><br>输入法就安装fcitx小企鹅输入法了</p>
<ol>
<li><p>安装输入法</p>
<p> <code>pacman -S fcitx</code>  </p>
</li>
<li>配置输入法<br> 安装输入法其他模块<br> <code>fcitx-ui-light</code> Fcitx 的轻量 UI.<br><code>fcitx-fbterm</code> Fbterm 对 Fcitx 的支持。<br><code>fcitx-table-extra</code> Fcitx 的一些额外码表支持，包括仓颉 3, 仓颉 5, 粤拼, 速成, 五笔, 郑码等等<br><code>fcitx-table-other</code> Fcitx 的一些更奇怪的码表支持，包括 Latex, Emoji, 以及一大堆不明字符等等。<br><code>kcm-fcitx</code> KDE 的 Fcitx 输入法模块</li>
<li>启动桌面环境时候启用输入法<br> 在 .bashrc 文件中加入如下代码<br> &gt;<br>export GTK_IM_MODULE=fcitx<br>export QT_IM_MODULE=fcitx<br>export XMODIFIERS=”@im=fcitx”</li>
</ol>
<p>退出用户，重新登陆，可以欢快的使用输入法了。</p>
</li>
</ul>
<p>ps:<br>浙大源：<code>Server = http://mirrors.zju.edu.cn/archlinux/$repo/os/$arch</code><br>网易源：<code>Server = http://mirrors.163.com/archlinux/$repo/os/x86_64</code><br>北京交大：<code>Server = http://mirror.bjtu.edu.cn/ArchLinux/$repo/os/x86_64</code></p>

	
	</div>
  <a type="button" href="/2016/03/09/archlinux安装/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/sql查找排除某些表后不存在某个字段的表/" >sql查找排除某些表后不存在某个字段的表</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> table_name <span class="keyword">FROM</span> information_schema.<span class="keyword">tables</span></span><br><span class="line"><span class="keyword">WHERE</span> table_schema=<span class="string">'database_name'</span></span><br><span class="line">	<span class="keyword">AND</span> table_name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'table_name'</span></span><br><span class="line">	<span class="keyword">AND</span> table_name <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="keyword">SELECT</span> <span class="keyword">col</span>.table_name  <span class="keyword">FROM</span> information_schema.<span class="string">`COLUMNS`</span> <span class="keyword">col</span></span><br><span class="line">	       <span class="keyword">WHERE</span> <span class="keyword">col</span>.table_name <span class="keyword">IN</span> (<span class="keyword">SELECT</span> table_name <span class="keyword">FROM</span> information_schema.<span class="keyword">tables</span></span><br><span class="line">					<span class="keyword">WHERE</span> table_schema=<span class="string">'database_name'</span></span><br><span class="line">					<span class="keyword">AND</span> table_name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'table_name'</span></span><br><span class="line">					<span class="keyword">AND</span> <span class="keyword">col</span>.column_name=<span class="string">'gmt_modified'</span>);</span><br></pre></td></tr></table></figure>

	
	</div>
  <a type="button" href="/2016/03/09/sql查找排除某些表后不存在某个字段的表/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/MySql避免重复插入记录/" >MySql避免重复插入记录</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="方案一：使用ignore关键字"><a href="#方案一：使用ignore关键字" class="headerlink" title="方案一：使用ignore关键字"></a>方案一：使用ignore关键字</h1><p>如果是用主键primary或者唯一索引unique区分了记录的唯一性,避免重复插入记录可以使用：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">ignore</span> <span class="keyword">into</span> table_name(email,phone,user_id) <span class="keyword">values</span>(<span class="string">'test9@163.com'</span>,<span class="string">'99999'</span>,<span class="string">'9999'</span>)</span><br></pre></td></tr></table></figure></p>
<p>这样当有重复记录就会忽略,执行后返回数字0,还有个应用就是复制表,避免重复记录：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="keyword">table</span>(<span class="keyword">name</span>)  <span class="keyword">select</span>  <span class="keyword">name</span> <span class="keyword">from</span> table2</span><br></pre></td></tr></table></figure></p>
<h1 id="方案二：使用Replace"><a href="#方案二：使用Replace" class="headerlink" title="方案二：使用Replace"></a>方案二：使用Replace</h1><p>replace的语法格式为：</p>
<ol>
<li><code>replace into table_name(col_name, ...) values(...)</code></li>
<li><code>replace into table_name(col_name, ...) select ...</code></li>
<li><code>replace into table_name set col_name=value, ...</code></li>
</ol>
<h2 id="算法说明："><a href="#算法说明：" class="headerlink" title="算法说明："></a>算法说明：</h2><p>REPLACE的运行与INSERT很相像,但是如果旧记录与新记录有相同的值，则在新记录被插入之前，旧记录被删除，即：</p>
<ol>
<li>尝试把新行插入到表中</li>
<li>当因为对于主键或唯一关键字出现重复关键字错误而造成插入失败时：<ul>
<li>从表中删除含有重复关键字值的冲突行</li>
<li>再次尝试把新行插入到表中<br>旧记录与新记录有相同的值的判断标准就是：表有一个PRIMARY KEY或UNIQUE索引，否则，使用一个REPLACE语句没有意义。该语句会与INSERT相同，因为没有索引被用于确定是否新行复制了其它的行。<h2 id="返回值："><a href="#返回值：" class="headerlink" title="返回值："></a>返回值：</h2>REPLACE语句会返回一个数，来指示受影响的行的数目。该数是被删除和被插入的行数的和。受影响的行数可以容易地确定是否REPLACE只添加了一行，或者是否REPLACE也替换了其它行：检查该数是否为1（添加）或更大（替换）。<h2 id="示例"><a href="#示例" class="headerlink" title="示例:"></a>示例:</h2>eg:(phone字段为唯一索引)<br><code>replace  into table_name(email,phone,user_id) values(&#39;test569&#39;,&#39;99999&#39;,&#39;123&#39;)</code><br>另外：在 SQL Server 中可以这样处理：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if not exists (<span class="keyword">select</span> phone <span class="keyword">from</span> t <span class="keyword">where</span> phone= <span class="string">'1'</span>)  </span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> t(phone, update_time) <span class="keyword">values</span>(<span class="string">'1'</span>, <span class="keyword">getdate</span>())</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">update</span> t <span class="keyword">set</span> update_time = <span class="keyword">getdate</span>() <span class="keyword">where</span> phone= <span class="string">'1'</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<p>更多信息<a href="http://dev.mysql.com/doc/refman/5.1/zh/sql-syntax.html#replace" target="_blank" rel="external">请看</a></p>
<h1 id="方案三：ON-DUPLICATE-KEY-UPDATE"><a href="#方案三：ON-DUPLICATE-KEY-UPDATE" class="headerlink" title="方案三：ON DUPLICATE KEY UPDATE"></a>方案三：ON DUPLICATE KEY UPDATE</h1><p>如‍上所写，你也可以在<code>INSERT INTO.....</code>后面加上 <code>ON DUPLICATE KEY UPDATE</code>方法来实现。如果您指定了<code>ON DUPLICATE KEY UPDATE</code>，并且插入行后会导致在一个UNIQUE索引或PRIMARY KEY中出现重复值，则执行旧行UPDATE。例如，如果列a被定义为UNIQUE，并且包含值1，则以下两个语句具有相同的效果：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">table</span> (a,b,c) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c=c+<span class="number">1</span>; `</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> c=c+<span class="number">1</span> <span class="keyword">WHERE</span> a=<span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果行作为新记录被插入，则受影响行的值为1；如果原有的记录被更新，则受影响行的值为2。注释：如果列b也是唯一列，则INSERT与此UPDATE语句相当：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">table</span> <span class="keyword">SET</span> c=c+<span class="number">1</span></span><br><span class="line"><span class="keyword">WHERE</span> a=<span class="number">1</span> <span class="keyword">OR</span> b=<span class="number">2</span> <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果a=1 OR b=2与多个行向匹配，则只有一个行被更新。通常，您应该尽量避免对带有多个唯一关键字的表使用ON DUPLICATE KEY子句。<br>您可以在UPDATE子句中使用VALUES(col_name)函数从INSERT…UPDATE语句的INSERT部分引用列值。换句话说，如果没有发生重复关键字冲突，则UPDATE子句中的VALUES(col_name)可以引用被插入的col_name的值。本函数特别适用于多行插入。VALUES()函数只在INSERT…UPDATE语句中有意义，其它时候会返回NULL。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">table</span> (a,b,c) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)    </span><br><span class="line"><span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c=<span class="keyword">VALUES</span>(a)+<span class="keyword">VALUES</span>(b);</span><br></pre></td></tr></table></figure></p>
<p>本语句与以下两个语句作用相同：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">table</span> (a,b,c) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)  <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c=<span class="number">3</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">table</span> (a,b,c) <span class="keyword">VALUES</span> (<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)  <span class="keyword">ON</span> <span class="keyword">DUPLICATE</span> <span class="keyword">KEY</span> <span class="keyword">UPDATE</span> c=<span class="number">9</span>;</span><br></pre></td></tr></table></figure></p>
<p>当您使用<code>ON DUPLICATE KEY UPDATE</code>时，<code>DELAYED</code>选项被忽略。<br>注：<a href="http://www.cnblogs.com/zeroone/archive/2012/04/18/2454728.html" target="_blank" rel="external">来源</a></p>

	
	</div>
  <a type="button" href="/2016/03/09/MySql避免重复插入记录/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/特定国家版windows8/" >特定国家版windows8</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<p>有强迫症的同学真是伤不起，他们就认定只有OEM厂商预装的系统才是正版的，其他通过密钥激活、kms激活的系统就是盗版的，为了满足这些同学的强迫症，笔者搜罗了半天网络资源，终于将OEM厂商使用的预装系统镜像收集完毕，他们分别是特定国家版（CoreCountrySpecific）和单语言版（CoreSingleLanguage），在大多华硕笔记本、联想笔记本中预装的系统通常显示为win8/8.1中文版，其实这些版本的实质就是特定国家版，今天给大家讲解一下他们与其他系统版本的区别以及分享一下他们的下载地址和有效安装密钥。</p>
<p>如何查看你预装的系统版本具体是什么？</p>
<p>win8/8.1中文版，可以通过注册表查看系统的具体版本，打开注册表定位到HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion，然后在右边找到EditionID和ProductName项，如果EditionID处显示为CoreCountrySpecific，ProductName处显示为Windows 8/8.1 China，那么就说明你预装的系统为特定国家版，如果EditionID处显示为CoreSingleLanguage，那么说明你预装的系统为单语言版，目前国内OEM厂商使用的基本就是这两种系统了。</p>
<p>特定国家版、单语言版与其他版本的区别是什么？</p>
<p>一般预装系统显示为win8/8.1中文版的大多都是特定国家版（CoreCountrySpecific），细心的同学可能会发现不管特定国家版还是单语言版，他们的英文名字都带一个“Core”，Core是什么呢？大家都知道win8/8.1分为核心板、专业版、企业版，那么Core就是核心板，这说明特定国家版和单语言版的实质就是核心板，他们与核心版的不同之处：特定国家使用，并且无法更换系统语言，比如是中文版，无法通过语言包或语言设置更换成其他版本，另外他们的密钥也不通用。（本文由 亦是美网络 yishimei.cn 原创）</p>
<p>为什么有些同学哭死哭活的要安装win8/8.1预装系统版本？</p>
<p>OEM厂商在电脑出厂时就将密钥集成在主板里了，如果使用预装系统的版本，在安装成功后，输入OEM集成在主板里的密钥就可以直接联网激活了，那些同学心目中的“正版概念”就是这么来的。</p>
<p>win8.1 CoreCountrySpecific（特定国家版）下载地址：</p>
<p>32位系统：<a href="http://pan.baidu.com/s/1dDCNHdR" target="_blank" rel="external">http://pan.baidu.com/s/1dDCNHdR</a></p>
<p>64位系统：<a href="http://pan.baidu.com/s/1c05ym0w" target="_blank" rel="external">http://pan.baidu.com/s/1c05ym0w</a></p>
<p>安装密钥：TNH8J-KG84C-TRMG4-FFD7J-VH4WX</p>
<p>激活方法：</p>
<p>1、使用安装密钥安装完成后，参考<a href="http://www.yishimei.cn/network/374.html" target="_blank" rel="external">（oem预装系统主板密钥提取神器 - RW - Read &amp; Write utility ）</a>获取系统集成的密钥，然后在线联网激活。</p>
<p>2、下载kms神龙版激活<a href="http://www.yishimei.cn/network/319.html" target="_blank" rel="external">（KMS在线激活windows8/8.1、windows7和office2013/2010之MicroKMS 神龙版）</a>。</p>
<p>win8.1 CoreSingleLanguage（单语言版）下载地址：</p>
<p>32位系统：<a href="http://pan.baidu.com/s/1bn3ytzx" target="_blank" rel="external">http://pan.baidu.com/s/1bn3ytzx</a></p>
<p>64位系统：<a href="http://pan.baidu.com/s/1hqGLrRA" target="_blank" rel="external">http://pan.baidu.com/s/1hqGLrRA</a></p>
<p>安装密钥：Y9NXP-XT8MV-PT9TG-97CT3-9D6TC</p>
<p>激活方法：同win8.1 CoreCountrySpecific（特定国家版）。</p>

	
	</div>
  <a type="button" href="/2016/03/09/特定国家版windows8/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/Spark基础知识/" >Spark基础知识</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="Spark基本概念"><a href="#Spark基本概念" class="headerlink" title="Spark基本概念"></a>Spark基本概念</h1><ul>
<li>RDD——Resillient Distributed Dataset A Fault-Tolerant Abstraction for In-Memory Cluster Computing弹性分布式数据集。</li>
<li>Operation——作用于RDD的各种操作分为transformation和action。</li>
<li>Job——作业，一个JOB包含多个RDD及作用于相应RDD上的各种operation。</li>
<li>Stage——一个作业分为多个阶段。</li>
<li>Partition——数据分区， 一个RDD中的数据可以分成多个不同的区。</li>
<li>DAG——Directed Acycle graph，有向无环图，反应RDD之间的依赖关系。</li>
<li>Narrow dependency——窄依赖，子RDD依赖于父RDD中固定的data partition。</li>
<li>Wide Dependency——宽依赖，子RDD对父RDD中的所有data partition都有依赖。</li>
<li>Caching Managenment——缓存管理，对RDD的中间计算结果进行缓存管理以加快整 体的处理速度。</li>
</ul>

	
	</div>
  <a type="button" href="/2016/03/09/Spark基础知识/#more" class="btn btn-default more">阅读此文</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2016-03-09 </div>
			<div class="article-title"><a href="/2016/03/09/SparkStreaming程序（及过程中问题解决）/" >运行第一个SparkStreaming程序（及过程中问题解决）</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="官方示例说明"><a href="#官方示例说明" class="headerlink" title="官方示例说明"></a>官方示例说明</h1><p>按照官方文档的 <a href="http://spark.apache.org/docs/1.0.0/streaming-programming-guide.html#a-quick-example" target="_blank" rel="external">这个示例说明</a>，可以轻松的在本地的spark-shell环境中测试这个示例。示例，即为了更好的入门，那么就再说明一下。<br>运行这个统计单词的方式有三种，前面两种是官方文档上的指引，第三种则是用scala程序运行。</p>
<hr>
<ul>
<li><h2 id="第一种方式-run-demo"><a href="#第一种方式-run-demo" class="headerlink" title="第一种方式, run-demo"></a>第一种方式, run-demo</h2></li>
</ul>
<ol>
<li>打开一个终端，打开一个终端，输入 命令 <code>nc -lk 9999</code>，暂时叫做 “nc终端” 吧</li>
<li><p>再打开终端，切换到Spark HOME目录， 执行命令 <code>bin/run-example org.apache.spark.examples.streaming.NetworkWordCount localhost 9999</code>， 然后每秒会有类似一下日志循环输出<br>&gt;<br>-——————————————<br>Time: 1415701382000 ms<br>-——————————————<br>-——————————————<br>Time: 1415701383000 ms<br>-——————————————</p>
</li>
<li><p>在nc终端随便输入一些字符串，用空格隔开，回车，如aa aa bb c。可以在上面的Spark终端中看到有新内容输出<br>&gt;<br>-——————————————<br>Time: 1415701670000 ms<br>-——————————————<br>(aa,2)<br>(bb,1)<br>(c,1)</p>
</li>
</ol>
<p>OK，成功！</p>
<hr>
<ul>
<li><h2 id="第二种-spark-shell-模式"><a href="#第二种-spark-shell-模式" class="headerlink" title="第二种 spark-shell 模式"></a>第二种 spark-shell 模式</h2>下面介绍在spark-shell中输入scala代码运行的方式。</li>
</ul>
<ol>
<li>同上面第一步，打开一个终端，打开一个终端，输入 命令 <code>nc -lk 9999</code>，暂时叫做 “nc终端” 吧</li>
<li><p>再打开一个终端， 切换到Spark HOME目录下，输入 <code>bin/spark-shell</code> （如果你已经安装好了Spark的话，直接输入 <code>spark-shell</code> 即可），等待Spark启动成功，会打印信息<br>&gt;<br>Spark context available as sc.<br>scala&gt;</p>
<p>然后输入以下语句：</p>
</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.streaming._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.<span class="type">StreamingContext</span>._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.api._</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a StreamingContext with a local master</span></span><br><span class="line"><span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(sc, <span class="type">Seconds</span>(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a DStream that will connect to serverIP:serverPort, like localhost:9999</span></span><br><span class="line"><span class="keyword">val</span> lines = ssc.socketTextStream(<span class="string">"localhost"</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Split each line into words</span></span><br><span class="line"><span class="keyword">val</span> words = lines.flatMap(_.split(<span class="string">" "</span>))</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.<span class="type">StreamingContext</span>._</span><br><span class="line"></span><br><span class="line"><span class="comment">// Count each word in each batch</span></span><br><span class="line"><span class="keyword">val</span> pairs = words.map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line"><span class="keyword">val</span> wordCounts = pairs.reduceByKey(_ + _)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Print a few of the counts to the console</span></span><br><span class="line">wordCounts.print()</span><br><span class="line">ssc.start()             <span class="comment">// Start the computation</span></span><br><span class="line">ssc.awaitTermination()  <span class="comment">// Wait for the computation to terminate</span></span><br></pre></td></tr></table></figure>
<p> 会打印以下信息：<br>&gt;<br>14/11/11 18:07:23 INFO MemoryStore: ensureFreeSpace(2216) called with curMem=100936, maxMem=278019440<br>.…..<br>14/11/11 18:07:23 INFO DAGScheduler: Stage 91 (take at DStream.scala:608) finished in 0.004 s<br>14/11/11 18:07:23 INFO SparkContext: Job finished: take at DStream.scala:608, took 0.007531701 s<br> -——————————————<br>Time: 1415700443000 ms<br>-——————————————</p>
<ol>
<li><p>同第一种方式的第3步，随便输入一些字符串，用空格隔开，回车，如aa aa bb c。可以在上面的Spark终端中看到有新内容输出<br>&gt;<br>-——————————————<br>Time: 1415701670000 ms<br>-——————————————<br>(aa,2)<br>(bb,1)<br>(c,1)</p>
<p>OK，成功！</p>
</li>
</ol>
<hr>
<ul>
<li><h2 id="第三种-scala-ide编程方式"><a href="#第三种-scala-ide编程方式" class="headerlink" title="第三种 scala-ide编程方式"></a>第三种 scala-ide编程方式</h2>在用这种方式运行这个demo代码的时候，遇到了不少问题，记录下来，供大家参考。这个例子，请大家先根据这里记录的方式进行操作，得到一个可以运行的程序，后面我会记录遇到的问题。</li>
</ul>
<ol>
<li>下载scala-ide, <a href="http://scala-ide.org/download/sdk.html" target="_blank" rel="external">下载链接</a>，下载 For Scala 2.10.4 下的对应平台的ide，解压，运行。</li>
<li>安装sbt，<a href="http://www.scala-sbt.org/download.html" target="_blank" rel="external">下载链接</a>,</li>
<li>安装sbteclipse, <a href="https://github.com/typesafehub/sbteclipse" target="_blank" rel="external">github地址</a>, 编辑 <code>~/.sbt/0.13/plugins/plugins.sbt</code> 文件， 添加以下内容 <code>addSbtPlugin(&quot;com.typesafe.sbteclipse&quot; % &quot;sbteclipse-plugin&quot; % &quot;2.5.0&quot;)</code>，如果没有plugins目录和plugins.sbt，自行创建。</li>
<li><p>用向导创建一个scala项目，并在项目根目录下创建一个build.sbt文件，添加以下内容(注意，每行正式语句之后要换行)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">name := &quot;spark-test&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version := &quot;1.0&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">scalaVersion := &quot;2.10.4&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// set the main class for the main &apos;run&apos; task</span><br><span class="line">// change Compile to Test to set it for &apos;test:run&apos;</span><br><span class="line">mainClass in (Compile, run) := Some(&quot;test.SparkTest&quot;)</span><br><span class="line"></span><br><span class="line">libraryDependencies += &quot;org.apache.spark&quot; % &quot;spark-streaming_2.10&quot; % &quot;1.1.0&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建test.SparkTest.scala文件，添加以下代码</p>
</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.<span class="type">StreamingContext</span>._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.api.java.function._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming._</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.streaming.api._</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">SparkTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// Create a StreamingContext with a local master</span></span><br><span class="line">    <span class="comment">// Spark Streaming needs at least two working thread</span></span><br><span class="line">    <span class="keyword">val</span> ssc = <span class="keyword">new</span> <span class="type">StreamingContext</span>(<span class="string">"local[2]"</span>, <span class="string">"NetworkWordCount"</span>, <span class="type">Seconds</span>(<span class="number">10</span>))</span><br><span class="line">    <span class="comment">// Create a DStream that will connect to serverIP:serverPort, like localhost:9999</span></span><br><span class="line">    <span class="keyword">val</span> lines = ssc.socketTextStream(<span class="string">"localhost"</span>, <span class="number">9999</span>)</span><br><span class="line">    <span class="comment">// Split each line into words</span></span><br><span class="line">    <span class="keyword">val</span> words = lines.flatMap(_.split(<span class="string">" "</span>))</span><br><span class="line">    <span class="comment">// Count each word in each batch</span></span><br><span class="line">    <span class="keyword">val</span> pairs = words.map(word =&gt; (word, <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">val</span> wordCounts = pairs.reduceByKey(_ + _)</span><br><span class="line">    wordCounts.print</span><br><span class="line">    ssc.start</span><br><span class="line">    ssc.awaitTermination</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>终端中切换目录到这个项目根目录，输入命令 <code>sbt</code> ， 命令运行成功后，敲入 <code>eclipse</code> 生成eclipse项目和项目所需依赖</li>
<li>同第一种方式的第1,3步，<br>再打开一个终端，输入 命令 <code>nc -lk 9999</code>。<br>然后运行刚才写的main程序，在nc终端中输入一些字符串，用空格隔开，回车，如aa aa bb c。可以在ide控制台中观察到<br>&gt;<br>-——————————————<br>Time: 1415701670000 ms<br>-——————————————<br>(aa,2)<br>(bb,1)<br>(c,1)</li>
</ol>
<p>OK，成功！</p>
<hr>
<h1 id="下面是遇到的问题及解决方法："><a href="#下面是遇到的问题及解决方法：" class="headerlink" title="下面是遇到的问题及解决方法："></a>下面是遇到的问题及解决方法：</h1><h3 id="1-运行程序说找不到主类"><a href="#1-运行程序说找不到主类" class="headerlink" title="1. 运行程序说找不到主类"></a>1. 运行程序说找不到主类</h3><p>解：没有在sbt文件配置主类是哪个，在<code>build.sbt</code>  文件中添加以下代码</p>
<blockquote>
<p>mainClass in (Compile, run) := Some(“test.SparkTest”)</p>
</blockquote>
<p> Some中就是主类的路径</p>
<h3 id="2-java-lang-NoClassDefFoundError-scala-collection-GenTraversableOnce-class"><a href="#2-java-lang-NoClassDefFoundError-scala-collection-GenTraversableOnce-class" class="headerlink" title="2. java.lang.NoClassDefFoundError: scala/collection/GenTraversableOnce$class"></a>2. java.lang.NoClassDefFoundError: scala/collection/GenTraversableOnce$class</h3><p>这个问题困扰了我很长时间，一直没找到怎么解决。后来看到说是scala每次版本升级不兼容以前的版本编译的库，于是换了对应的版本的ide才正常运行。<br>解：scala-ide版本和现在用的spark包依赖编译的scala版本不一致， 请下载上面说过的 <code>scala-ide For Scala 2.10.4</code> 版本。</p>

	
	</div>
  <a type="button" href="/2016/03/09/SparkStreaming程序（及过程中问题解决）/#more" class="btn btn-default more">阅读此文</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/page/2/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/4/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/android/">android<span>1</span></a></li>
		
			<li><a href="/categories/git/">git<span>1</span></a></li>
		
			<li><a href="/categories/golang/">golang<span>9</span></a></li>
		
			<li><a href="/categories/hadoop/">hadoop<span>2</span></a></li>
		
			<li><a href="/categories/java/">java<span>1</span></a></li>
		
			<li><a href="/categories/linux/">linux<span>4</span></a></li>
		
			<li><a href="/categories/mysql/">mysql<span>1</span></a></li>
		
			<li><a href="/categories/other/">other<span>1</span></a></li>
		
			<li><a href="/categories/spark/">spark<span>3</span></a></li>
		
			<li><a href="/categories/spring/">spring<span>5</span></a></li>
		
			<li><a href="/categories/sql/">sql<span>1</span></a></li>
		
			<li><a href="/categories/sqoop/">sqoop<span>2</span></a></li>
		
			<li><a href="/categories/windows/">windows<span>1</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/archlinux/">archlinux<span>2</span></a></li>
		
			<li><a href="/tags/进程/">进程<span>1</span></a></li>
		
			<li><a href="/tags/spring/">spring<span>4</span></a></li>
		
			<li><a href="/tags/软件/">软件<span>1</span></a></li>
		
			<li><a href="/tags/spark-streaming/">spark-streaming<span>2</span></a></li>
		
			<li><a href="/tags/安卓/">安卓<span>1</span></a></li>
		
			<li><a href="/tags/linux/">linux<span>3</span></a></li>
		
			<li><a href="/tags/hive/">hive<span>1</span></a></li>
		
			<li><a href="/tags/端口/">端口<span>1</span></a></li>
		
			<li><a href="/tags/spark/">spark<span>4</span></a></li>
		
			<li><a href="/tags/ntfs/">ntfs<span>1</span></a></li>
		
			<li><a href="/tags/spring-xd/">spring-xd<span>3</span></a></li>
		
			<li><a href="/tags/录音/">录音<span>1</span></a></li>
		
			<li><a href="/tags/golang/">golang<span>10</span></a></li>
		
			<li><a href="/tags/git/">git<span>1</span></a></li>
		
			<li><a href="/tags/go/">go<span>8</span></a></li>
		
			<li><a href="/tags/android/">android<span>1</span></a></li>
		
			<li><a href="/tags/http/">http<span>1</span></a></li>
		
			<li><a href="/tags/sql/">sql<span>1</span></a></li>
		
			<li><a href="/tags/zookeeper/">zookeeper<span>2</span></a></li>
		
		
		   <li><a href="/tags">...<span>31</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2016/03/16/sparkApp提交到SpringXD出现错误可能情况及解决方法/" ><i class="fa fa-file-o"></i>sparkApp提交到SpringXD出现错误可能情况...</a>
      </li>
    
      <li>
        <a href="/2016/03/15/linux下根据端口号查询对应进程/" ><i class="fa fa-file-o"></i>linux下根据端口号查询对应进程</a>
      </li>
    
      <li>
        <a href="/2016/03/15/golang打印错误栈信息/" ><i class="fa fa-file-o"></i>golang打印错误栈信息</a>
      </li>
    
      <li>
        <a href="/2016/03/15/golang容易忽略导致入坑的方面/" ><i class="fa fa-file-o"></i>golang容易忽略导致入坑的方面</a>
      </li>
    
      <li>
        <a href="/2016/03/14/sink-hdfs/" ><i class="fa fa-file-o"></i>sink-hdfs</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/wzpan" title="My Github account." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="http://www.linkedin.com/in/sdvdxl" title="My Linkin account." target="_blank"]);">My LinkedIn</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2016 杜龙少
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
